{% comment %} <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Estimation</title>
</head>
<body>
    <h1>Pose Estimation with Flask</h1>
    
    <form id="image-form" method="POST" enctype="multipart/form-data">
        <label for="image">Upload Image:</label>
        <input type="file" id="image" name="image" accept="image/*" required>
        <button type="submit">Submit</button>
    </form>

    <div id="result"></div>

    <script>
        const form = document.getElementById("image-form");
        const resultDiv = document.getElementById("result");
    
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
    
            const file = document.getElementById("image").files[0];
            const reader = new FileReader();
    
            reader.onloadend = async function() {
                // Extract base64 image data
                const base64Image = reader.result;
    
                const formData = new FormData();
                formData.append("image", base64Image); // Append base64 image directly
    
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
    
                const data = await response.json();
    
                if (data.label) {
                    resultDiv.innerHTML = `<h3>Predicted Label: ${data.label}</h3>`;
                } else {
                    resultDiv.innerHTML = `<h3>Error: ${data.error}</h3>`;
                }
            };
    
            reader.readAsDataURL(file); // Convert file to base64
        });
    </script>
    
</body>
</html> {% endcomment %}




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Prediction</title>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
    <style>
        #video-container {
            position: relative;
            width: 80%;
            margin: 0 auto;
        }
        #video {
            width: 100%;
            height: auto;
        }
        #predicted-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            display: none;
        }
        #error {
            color: red;
            text-align: center;
            font-size: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Pose Prediction</h1>
    <div id="video-container">
        <video id="video" autoplay></video>
        <img id="predicted-frame" src="" alt="Processed Frame">
        <div id="error"></div>
    </div>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const videoElement = document.getElementById('video');
        const predictedFrame = document.getElementById('predicted-frame');
        const errorDiv = document.getElementById('error');

        // Start video capture
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                videoElement.srcObject = stream;
                startSendingFrames(stream);
            })
            .catch((error) => {
                console.error("Error accessing camera:", error);
                errorDiv.textContent = 'Error accessing camera';
                errorDiv.style.display = 'block';
            });

        // Function to capture and send frames
        function startSendingFrames(stream) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            setInterval(() => {
                // Draw current video frame onto the canvas
                ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

                // Convert canvas to base64 image
                const base64Image = canvas.toDataURL('image/jpeg');

                // Send image to server
                socket.emit('image', base64Image);
            }, 100); // Send frame every 100ms (10 frames per second)
        }

        // Handle prediction results
        socket.on('prediction', (data) => {
            const { label, frame } = data;
            const img = new Image();
            img.src = 'data:image/jpeg;base64,' + frame;
            img.onload = () => {
                // Display the processed frame
                predictedFrame.src = img.src;
                predictedFrame.style.display = 'block';

                // Log the pose prediction label
                console.log('Predicted Pose:', label);
            };
        });

        // Handle errors
        socket.on('error', (data) => {
            const { error } = data;
            console.error('Error:', error);
            errorDiv.textContent = error;
            errorDiv.style.display = 'block';
        });
    </script>
</body>
</html>
